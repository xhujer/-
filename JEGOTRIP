#!name=无忧行去广告（终极版）
#!desc=全接口拦截，无忧榜单/攻略/达人推荐及广告模块彻底屏蔽
#!tag=去广告
#!icon=https://imgtolinkx.com/i/CO0eIFoS
#!openUrl=https://apps.apple.com/app/id1037589370
#!bundleId=com.cmi.jegotrip
#!date=2025-08-31

[Rewrite]
# 已知广告接口
^https?:\/\/app3\.jegotrip\.com\.cn\/api\/destination\/v1\/(banner|getDestBanners|rec|recommend|rec/columnListByRegion|rec/queryData|rec/sceneQuery|poi/queryJegoListAndNameByDestinationId|poi/queryRecommendList|poi/queryAdsPoiList) reject-dict

[Script]
// 全局拦截 /destination/v1/ 接口，递归清理
http-response ^https?:\/\/app3\.jegotrip\.com\.cn\/api\/destination\/v1\/.* script-body=true,requires-body=true,tag=无忧行去广告

[MitM]
hostname=app3.jegotrip.com.cn,push.it.10086.cn,oss.jegotrip.com.cn,umeng.com,bugly.qq.com

// -------- 内置 JS 脚本内容 --------
function removeAds(obj) {
    if (!obj) return obj;
    if (Array.isArray(obj)) {
        return obj.filter(item => {
            if (item && item.title) {
                return !(/无忧|攻略|达人/.test(item.title));
            }
            return true;
        });
    } else if (typeof obj === 'object') {
        for (let key in obj) {
            obj[key] = removeAds(obj[key]);
        }
    }
    return obj;
}

let body;
try {
    body = JSON.parse($response.body);
} catch(e) {
    $done({});
}

// 全字段递归删除
body = removeAds(body);

// 删除已知广告字段
if (body.data) {
    delete body.data.bannerList;
    delete body.data.recommend;
    delete body.data.columnListByRegion;
    delete body.data.poiList;
    delete body.data.promotionList;
    delete body.data.strategyList;
    delete body.data.destinationGlobalGroupResp;
}
if (body.data && body.data.userCenter) {
    delete body.data.userCenter.ads;
    delete body.data.userCenter.bannerList;
    delete body.data.userCenter.models;
}

$done({ body: JSON.stringify(body) });
