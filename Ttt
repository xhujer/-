#!name=Cainiao Clean
#!desc=菜鸟 我的页面 + 底部 Tab 精简 去广告
#!author=明 x ChatGPT
#!system=ios

[Script]
http-response ^https:\/\/guide-acs\.m\.cainiao\.com\/gw\/mtop\.cainiao\.app\.e2e\.engine\.page\.fetch\.cn requires-body=1,max-size=0,script-path=cainiao_mine_clean.js,tag=Cainiao_Mine_Clean
http-response ^https:\/\/guide-acs\.m\.cainiao\.com\/gw\/mtop\.cainiao\.app\.e2e\.engine\.tabbar\.fetch\.cn requires-body=1,max-size=0,script-path=cainiao_tab_clean.js,tag=Cainiao_Tab_Clean

[Script Content]
cainiao_mine_clean.js = 
"""
let body = $response.body;
if (body) {
  let obj = JSON.parse(body);
  if (obj?.data?.data) {
    let data = obj.data.data;
    // 删除广告模块
    delete data.wallet;   // 绿色回收
    delete data.banner;   // 轮播广告
    delete data.activity; // 活动/小游戏
    delete data.asset;    // 红包卡券/寄件优惠/环保金/积分
    delete data.vip;      // 会员成长
    // 精简订单，仅保留寄件订单和购物订单
    if (data.order?.data?.items) {
      data.order.data.items = data.order.data.items.filter(i => i.type !== "huishou");
    }
  }
  $done({ body: JSON.stringify(obj) });
} else {
  $done({});
}
"""

cainiao_tab_clean.js = 
"""
let body = $response.body;
if (body) {
  let obj = JSON.parse(body);
  if (obj?.data?.tabs) {
    obj.data.tabs = obj.data.tabs.filter(tab =>
      ["首页", "包裹", "我的"].includes(tab.title)
    );
  }
  $done({ body: JSON.stringify(obj) });
} else {
  $done({});
}
"""
