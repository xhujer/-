/**
 * @name 网易邮箱大师图标解锁 (增强版)
 * @desc 深度覆盖 detail3 接口，确保权限下发
 */

let body = $response.body;
if (!body) $done({}); 

try {
    let obj = JSON.parse(body);

    // 递归处理函数：遍历对象，只要发现权限关键字就改写
    const unlock = (target) => {
        if (!target || typeof target !== 'object') return;
        
        // 修改关键会员字段
        if (target.hasOwnProperty('isMember')) target.isMember = true;
        if (target.hasOwnProperty('hasMasterPrvlg')) target.hasMasterPrvlg = true;
        if (target.hasOwnProperty('mbrType')) target.mbrType = 1;
        if (target.hasOwnProperty('endTime')) target.endTime = 4092599349000; // 2099年
        if (target.hasOwnProperty('vipStatus')) target.vipStatus = 1;

        // 递归处理嵌套的对象或数组 (兼容 master/plus 嵌套)
        for (let key in target) {
            if (typeof target[key] === 'object') unlock(target[key]);
        }
    };

    // 执行解锁逻辑
    unlock(obj);

    $done({ body: JSON.stringify(obj) });
} catch (e) {
    console.log("网易邮箱解锁脚本执行异常: " + e);
    $done({ body }); // 出错时返回原包，保证 App 正常运行
}
