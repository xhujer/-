#!name=HDHive è‡ªåŠ¨ç­¾åˆ° (å†…åµŒç‰ˆ)
#!desc=åˆäºŒä¸ºä¸€ç‰ˆï¼šæ— éœ€ä¸‹è½½å¤–éƒ¨è„šæœ¬ã€‚åŒ…å«è‡ªåŠ¨æŠ“å– Token å’Œæ¯æ—¥å®šæ—¶ç­¾åˆ°åŠŸèƒ½ã€‚
#!author=ming & Gemini
#!icon=https://hdhive.com/favicon.ico
#!homepage=https://hdhive.com/

[Argument]
Cron = input,"0 9 * * *",tag=ç­¾åˆ°æ—¶é—´,desc=Cronè¡¨è¾¾å¼ï¼Œé»˜è®¤æ¯å¤©ä¸Šåˆ9ç‚¹

[Script]
# 1. æŠ“å–å‡­è¯ (è®¿é—®ç½‘é¡µæ—¶è§¦å‘)
http-request ^https?:\/\/hdhive\.com\/api\/ script-path=HDHiveCore, tag=HDHiveè·æƒ, timeout=10, enable=true

# 2. å®šæ—¶ç­¾åˆ° (åå°è‡ªåŠ¨è¿è¡Œ)
cron {Cron} script-path=HDHiveCore, tag=HDHiveç­¾åˆ°, timeout=60

[Mitm]
hostname = hdhive.com

# ==============================================
# ä¸‹é¢æ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œç›´æ¥å†…åµŒåœ¨æ’ä»¶ä¸­ï¼Œæ— éœ€é¢å¤–æ–‡ä»¶
# ==============================================

[InlineScript]
HDHiveCore = "const API='https://hdhive.com/api/customer/user/checkin';const KEY_T='hdhive_token';const KEY_C='hdhive_csrf';if(typeof $request!=='undefined'){const h=$request.headers;const t=h['Authorization']||h['authorization'];const c=h['x-csrf-token']||h['X-Csrf-Token'];if(t&&c){const oldT=$persistentStore.read(KEY_T);if(t!==oldT){$persistentStore.write(t,KEY_T);$persistentStore.write(c,KEY_C);$notification.post('HDHive','ğŸ‰ å‡­è¯å·²è‡ªåŠ¨æ›´æ–°','æ— éœ€æ“ä½œï¼Œå·²ä¿å­˜æ–°Token');console.log('[HDHive] Token updated: '+t);}}$done({});}else{const t=$persistentStore.read(KEY_T);const c=$persistentStore.read(KEY_C);if(!t||!c){$notification.post('HDHive','âŒ ç­¾åˆ°å¤±è´¥','æœªæ£€æµ‹åˆ°å‡­è¯ï¼Œè¯·å…ˆç”¨æµè§ˆå™¨è®¿é—® hdhive.com');$done({});}else{$httpClient.post({url:API,headers:{'Authorization':t,'x-csrf-token':c,'Origin':'https://hdhive.com','Referer':'https://hdhive.com/user/dashboard','User-Agent':'Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1'}},(e,r,d)=>{if(!e&&(r.status===200||r.status===201)){let msg='ç­¾åˆ°æˆåŠŸ';try{msg=JSON.parse(d).message||msg}catch(x){}$notification.post('HDHive','âœ… ç­¾åˆ°æˆåŠŸ',msg);console.log('[HDHive] Success: '+d);}else{if(r&&r.status===401){$notification.post('HDHive','âš ï¸ ç­¾åˆ°å¤±è´¥','Token å·²å¤±æ•ˆï¼Œè¯·é‡æ–°è®¿é—®ç½‘é¡µè·å–');}else{$notification.post('HDHive','âŒ ç­¾åˆ°å¤±è´¥','çŠ¶æ€ç :'+(r?r.status:e));console.log('[HDHive] Error: '+d);}}$done({});});}}"
