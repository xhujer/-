/*
è„šæœ¬ä½œè€…ï¼šå¯è‰ğŸ…¥ & chxm1023 (Modified)
åŠŸèƒ½æè¿°ï¼šç½‘æ˜“é‚®ç®±å¤§å¸ˆè§£é”æœ¬åœ°ä¼šå‘˜æƒç›Š
ä½¿ç”¨å£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œè¯·å‹¿å•†ç”¨
*/

var body = $response.body;
var url = $request.url;

// åˆ¤æ–­æ˜¯å¦æ˜¯ JSON æ•°æ®
if (body) {
  var obj = JSON.parse(body);

  // 1. å¤„ç†ç”¨æˆ·ä¿¡æ¯/æƒç›Šæ¥å£
  if (url.indexOf('privilege/info') !== -1 || url.indexOf('vip/info') !== -1) {
    // å¼ºåˆ¶ä¿®æ”¹è¿‡æœŸæ—¶é—´åˆ° 2099 å¹´ (æ—¶é—´æˆ³)
    var expireTime = 4092599349000;
    
    // ä¿®æ”¹ VIP çŠ¶æ€
    if (obj.data) {
      obj.data.memberType = 1; // 1 é€šå¸¸ä»£è¡¨é«˜çº§ä¼šå‘˜
      obj.data.expireTime = expireTime;
      obj.data.vipExpireTime = expireTime;
      
      // å¦‚æœæœ‰ privileges æ•°ç»„ï¼Œå…¨éƒ¨è®¾ä¸º true
      if (obj.data.privileges) {
        for (var i = 0; i < obj.data.privileges.length; i++) {
            obj.data.privileges[i].expireTime = expireTime;
            obj.data.privileges[i].isValid = true;
        }
      }
    }
  }

  $done({ body: JSON.stringify(obj) });
} else {
  $done({});
}
